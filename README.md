# WorkMate(仮)
チャットbot機能付き進捗管理アプリ  

## 概要
- 自身の進捗管理や目標管理をでき、チャットbotなどでも管理、支援できるアプリ
- 現状はチャットbotのような動きにするだけでOpenAIのAPIは未使用 
- Spring Boot/  / Thymeleaf / PostgreSQLを使用
- 開発環境：Eclipse / VScode

## 主機能
- ユーザー登録/ログイン機能  
- 進捗の管理(完了/未完了など)・登録・更新・削除  
- チャット形式でのタスク管理支援

## 余裕があれば追加  
- カレンダー表示  
- 週報レポートの自動作成  
- メールなどの通知  
- タスクにソート機能(日付・時間やタスク名順など)

## 開発記録(週ごとの進捗)  

### 1週目  
- 機能定義・テーブル設計・画面遷移など外部設計から入り、ざっくり決定
- Spring Bootを初めて用いてプロジェクトを作成
- ログイン機能と新規ユーザー登録、DB保存などの処理を一通り実装

  #### メモ
  - `@アノテーション` を記述して実行環境や外部に対してプログラムがどういうものか、何をやってほしいのかを指定できる  
  - DB接続はSpring Boot側の構成機能で簡略化してくれる
    →　`application properties` に接続情報を記述するだけでOK
  - ログインの流れとしては入力された情報をDBのユーザーデータから探し、パスワードと照合してログインの可否を判定する
  - ログインできればセッションに情報を保存
  - 登録は入力された情報を受け取り新規でDBに保存する
  - まだ記述や仕組みなどは理解が浅いと感じた

### 2週目
- ユーザーごとのタスク表示、登録・削除機能の実装
- タスクページに遷移するとセッション情報を取得してそのユーザーのタスクを表示  
- 登録、編集時に入力フォームに遷移し、送られてきたデータをDBに保存したり更新する
- 削除ボタンを押すとそのタスクを削除

  #### メモ
  - Entity(ドメイン)はデータテーブルに対応する実体でこのクラスでデータベースとのやりとりを行う
  - RepositoryはDBに対する操作(検索・保存・更新・削除など)で橋渡し役     
  - DTOはフォーム入力のためのクラスで一時的にデータを受け渡す  
    これだけでDBに保存されるわけではなく画面⇔サーバー間のデータ受け渡し用
  - フォームは登録と編集に対応していて、idがnullなら登録に、入っているなら編集になる

### 3週目
- タスクの編集機能の実装
- Spring Securityを利用したセキュリティの導入
- タスクに対して軽度の検索・ソート機能の実装
- タイトル・優先度・カテゴリで絞ったり作成日や期限日をソートして昇順や降順にできるなどの機能を実装

  #### メモ
  - パスワードをBCryptで暗号化して保存し、ログインで認証して使えるようにした
  - ログインしていないときの特定のページへのアクセスを制限
  - Spring Securityの実装に伴いログイン用コントローラーの記述を大幅に削除
  - 軽度の検索やソート機能を実装したがもう少し工夫をしたかったので組み合わせて使える機能を実装

### 4週目
- タスク一覧ページの見た目を少し整えた
- チャットbot風機能とページの実装

  #### メモ
  - タスクのページをなるべく見やすいように工夫した
  - 画面上でメッセージを入力→表示をとりあえず画面遷移で表示させる
  - 現状の返答ロジックは特定のキーワードをMapにし、反応して定型文を返す
  - 会話をユーザーかボット区別してDBに保存し、ユーザーごとに履歴を表示

### 5週目
- チャットページの見た目を整え、下に自動スクロールを実装
- 少し全体の機能のチェック&修正
- チャットボットの返答ロジックに仕組み追加
- ユーザーのメッセージに含むキーワードとボットの定型文にタグを付与

  #### メモ
  - 見た目をユーザーかボットかわかりやすくした
  - ログアウト時にセッションが削除できていなかったので修正
  - チャットボットの返答に複数の候補から優先度を参照しランダムに選択させたり、時間帯で変えたりして工夫した
  - DBにタグのテーブルと中間テーブルを用意して、中間テーブルを通して返答の定型文とタグのIDを紐づけ
  - ユーザー側はいくつかの候補をMapで用意したが余裕があればこちらもDBで管理したい
  
### 6週目
- タグによる定型文の返答を実装
- チャットを通してタスクの管理ができる機能をコマンド形式で実装
- 記述の見直し

  #### メモ
  - タグによって候補を出して既存のフィルタリングを実行し、候補を1つに絞って返す
  - 定型文を増やすのが大変だったのでとりあえずいくつかだけ用意
  - 自然な会話でタスクの管理をするのは難しすぎるのでとりあえずコマンド形式にした
  - 決められたコマンドを入力するとタスクの管理ができる(例：/add /title タスク名、 /list など)
    - リスト表示、タスク登録を実装
    - リストはワード検索して絞ったり、ソートして組み合わせることも可能(例：/list /タスク名 〇〇 /ソート 昇順など)
  - チャットでのタスク管理を実装に伴い、タスクの処理を行っていた記述をコントローラー側でまとめて書いてしまっていたためサービスに切り分けてチャット用からも再利用できるようにした

### 7週目
- 先週に引き続きコマンド方式の実装
- コマンドの種類を追加
- ある程度の表記ゆれなどに対応

  #### メモ
  - コマンド入力時に表記ゆれなどが起こるだけで実行されないのでAlias専用クラスを作成してある程度の表記ゆれに対応した
    - 英語と日本語にも対応(進捗がみたいなら/status →/進捗 などどちらも可)
  - 新たにコマンドを複数追加
    - 更新ができる/update、タスクを指定して進捗のみをすぐに更新できる/done /doing /todo、コマンドの説明や使い方がみれる/help、タスク全体の状況やカテゴリ別に進捗状態がみれる/statsなど
    - 
### 8週目
- 検索に期限日も指定できるようにし1週間や1ヶ月、期間指定に対応した
  #### メモ
  - 検索が複雑になってきたので検索用のDTOを作成
  - streamに対して理解が足りてないので最初はfor文などで書いてからリファクタリングなどをしていきたい

## エラーなどのメモ  
- エラー：`TemplateInputException`  
- 原因：HTMLファイルの中身に文法エラーや構文ミスがあった  
- 対処：{変数}に$がぬけていたり、構文エラーを修正
- エラー：`MissingServletRequestParameterException`
- 原因：必要なリクエストパラメータがリクエストに含まれていない
- 対処：うまく渡せていなかったので訂正した
- エラー：`QueryCreationException`
- 原因：リポジトリに与えたい操作に対してのクエリの構文が間違っていた
- 対処：@Queryに記述したものを修正
- エラー：`NoResourceFoundException`
- 原因：パスにHTMLファイルがみつからなかった
- エラー：`unexpected error`
- 原因：リストの表示がcharacter varying(255)を超えてしまった
- 対処：大きさを1000に変更

