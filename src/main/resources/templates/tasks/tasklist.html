<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>タスク管理</title>
</head>
<body>
    <h1>タスク一覧</h1>
    <form th:action="@{/tasks/search}" method="get">
        タイトル：<input type="text" name="title" th:value="${title}" placeholder="キーワードを入力">
        期限日：<input type="text" name="dueDate" th:value="${dueDate}" placeholder="例：yyyy-MM-dd">
        進捗状況：
        <select name="status">
            <option value="">--選択--</option>
            <option value="未着手" th:selected="${status=='未着手'}">未着手</option>
            <option value="進行中" th:selected="${status=='進行中'}">進行中</option>
            <option value="完了" th:selected="${status=='完了'}">完了</option>
        </select>
        優先度：
        <select name="priority">
            <option value="">--選択--</option>
            <option value="高" th:selected="${priority=='高'}">高</option>
            <option value="中" th:selected="${priority=='中'}">中</option>
            <option value="低" th:selected="${priority=='低'}">低</option>
        </select>
        カテゴリ：
        <select name="category">
            <option value="">--選択--</option>
            <option value="仕事" th:selected="${category=='仕事'}">仕事</option>
            <option value="趣味" th:selected="${category=='趣味'}">趣味</option>
            <option value="勉強" th:selected="${category=='勉強'}">勉強</option>
            <option value="生活" th:selected="${category=='生活'}">生活</option>
            <option value="その他" th:selected="${category=='その他'}">その他</option>
        </select>
        ソート：
        <select name="sortBy">
            <option value="dueDate" th:selected="${sortBy=='dueDate'}">期限日</option>
            <option value="createdAt" th:selected="${sortBy=='createdAt'}">作成日</option>
        </select>
        <select name="order">
            <option value="asc" th:selected="${order=='asc'}">昇順</option>
            <option value="desc" th:selected="${order=='desc'}">降順</option>
        </select>
        <button type="submit" >検索</button>
        <a th:href="@{/tasks/refresh}">元に戻す</a>
    </form>
    
    <!--
    <label>ソート:</label>
    <a th:href="@{/tasks/tasklist/sort(sortBy='dueDate')}">期限日順</a> |
    <a th:href="@{/tasks/tasklist/sort(sortBy='createdAt')}">作成日順</a>
    -->
    <table border="1">
        <thead>
            <tr>
                <th>タイトル</th>
                <th>内容</th>
                <th>締め切り</th>
                <th>進捗状況</th>
                <th>優先度</th>
                <th>カテゴリ</th>
                <th>作成日</th>
                <th>更新日</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="task : ${tasks}">
                <td th:text="${task.title}"></td>
                <td th:text="${task.description}"></td>
                <td th:text="${#temporals.format(task.dueDate, 'yyyy-MM-dd')}"></td>
                <td th:text="${task.status}"></td>
                <td th:text="${task.priority}"></td>
                <td th:text="${task.category}"></td>
                <td th:text="${#temporals.format(task.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                <td th:text="${#temporals.format(task.updatedAt, 'yyyy-MM-dd HH:mm')}"></td>
        
                <td> 
                    <form th:action="@{'/tasks/edit/' + ${task.id}}" method="get" style="display:inline">
                        <input type="submit" value="編集" >
                    </form>
                    <form th:action="@{'/tasks/delete/' + ${task.id}}" method="post" style="display:inline">
                        <input type="submit" value="削除" onclick="return confirm('本当に削除しますか？');">
                    </form>
                </td>
            </tr>
        </tbody>
    </table>
    <a th:href="@{/tasks/new}">タスクを登録</a>
    <a th:href="@{/dashboard}">メニューに戻る</a>
</body>
</html>